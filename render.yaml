services:
  # PostgreSQL database service
  - type: pserv
    name: zorpido-postgres
    ipAddress: 10.5.0.3
    plan: free
    region: oregon
    databaseName: zorpido_db
    user: zorpido_user
    # PostgreSQL version
    version: 15

  # Web service
  - type: web
    name: zorpido-web
    runtime: python311
    plan: free
    region: oregon
    buildCommand: |
      pip install -r requirements.txt
      python manage.py collectstatic --noinput
      python manage.py migrate --noinput
    startCommand: gunicorn zorpido_config.wsgi:application --workers 3 --bind 0.0.0.0:$PORT --log-file -
    envVars:
      # Django configuration
      - key: DJANGO_SETTINGS_MODULE
        value: zorpido_config.settings.production
      
      - key: DEBUG
        value: "False"
      
      # Django secret key (required - must be set in Render dashboard)
      - key: DJANGO_SECRET_KEY
        sync: false
      
      # Allowed hosts - update with your domain
      - key: ALLOWED_HOSTS
        value: localhost,127.0.0.1,*.onrender.com,your-domain.com
      
      # CSRF trusted origins - update with your domain
      - key: CSRF_TRUSTED_ORIGINS
        value: https://*.onrender.com,https://your-domain.com
      
      # Database URL - automatically set by Render via the PostgreSQL service connection
      - key: DATABASE_URL
        fromService:
          type: pserv
          name: zorpido-postgres
          property: connectionString
      
      # Security settings
      - key: SECURE_SSL_REDIRECT
        value: "True"
      
      - key: SESSION_COOKIE_SECURE
        value: "True"
      
      - key: CSRF_COOKIE_SECURE
        value: "True"
      
      - key: SECURE_HSTS_SECONDS
        value: "31536000"
      
      - key: SECURE_HSTS_INCLUDE_SUBDOMAINS
        value: "True"
      
      - key: SECURE_HSTS_PRELOAD
        value: "True"
      
      # Optional: Cloudinary for media uploads
      # Uncomment and set if using Cloudinary for media storage
      # - key: CLOUDINARY_URL
      #   sync: false
    
    # Auto-deploy on git push to main branch
    autoDeploy: true
